"use strict";var stripe=Stripe(direct_stripe_script_vars.p_key);function registerElements(c,u){var e="."+u,d=document.querySelector(e),p=d.querySelector("form"),t=d.querySelector("a.reset"),r=p.querySelector(".error"),m=r.querySelector(".message"),n=jQuery(p).data("id"),y=window[n];function f(){Array.prototype.forEach.call(p.querySelectorAll("input[type='text'], input[type='email'], input[type='tel']"),function(e){e.removeAttribute("disabled")})}var i={};c.forEach(function(e,n){e.on("change",function(e){if(e.error)r.classList.add("visible"),i[n]=e.error.message,m.innerText=e.error.message;else{i[n]=null;var t=Object.keys(i).sort().reduce(function(e,t){return e||i[t]},null);t?m.innerText=t:r.classList.remove("visible")}})}),p.addEventListener("submit",function(e){e.preventDefault();var t=!0;if(Array.prototype.forEach.call(p.querySelectorAll("input"),function(e){!e.checkValidity||e.checkValidity()||(t=!1)}),t){d.classList.add("submitting"),Array.prototype.forEach.call(p.querySelectorAll("input[type='text'], input[type='email'], input[type='tel']"),function(e){e.setAttribute("disabled","true")});var n=p.querySelector("#"+u+"-name"),r=p.querySelector("#"+u+"-email"),i=p.querySelector("#"+u+"-address"),o=p.querySelector("#"+u+"-city"),a=p.querySelector("#"+u+"-state"),s=p.querySelector("#"+u+"-zip"),l={name:n?n.value:void 0,email:r?r.value:void 0,address:{line1:i?i.value:void 0,city:o?o.value:void 0,state:a?a.value:void 0,postal_code:s?s.value:void 0}};stripe.createPaymentMethod("card",c[0],{billing_details:l}).then(function(t){console.log(t),t.error?(f(),m.innerText=t.error.message):stripe.createToken(c[0],{}).then(function(e){e.token&&stripe_checkout(e.token,y,l,t.paymentMethod.id)})})}else!function(){console.log("triggerBrowserValidation");var e=document.createElement("input");e.type="submit",e.style.display="none",p.appendChild(e),e.click(),e.remove()}()}),t.addEventListener("click",function(e){e.preventDefault(),p.reset(),c.forEach(function(e){e.clear()}),r.classList.remove("visible"),f(),d.classList.remove("submitted")})}function stripe_checkout(e,t,n,r){document.querySelector(".example5");var i=t,o=i.type;i.instance,i.instance;if("donation"===o)var a=setDonationValue(i.instance);else a=i.amount;console.log(r),jQuery.post(t.ajaxurl,{action:"ds_process_button",stripeToken:e.id,paymentMethodID:r,stripeEmail:e.email,type:o,amount:a,params:i,ds_nonce:i.ds_nonce},function(e){console.log(e),handleServerResponse(e,t)})}function handleServerResponse(e,t){console.log(e),e.error||e.requires_action&&stripe.handleCardAction(e.payment_intent_client_secret).then(function(e){e.error||jQuery.post(t.ajaxurl,{action:"ds_process_button",paymentIntentID:e.paymentIntent.id,params:t,ds_nonce:t.ds_nonce},function(e){switch(e.id){case"1":example.classList.remove("submitting"),example.classList.add("submitted"),jQuery(ds_answer_input).addClass("success"),jQuery(ds_answer_input).html(e.message),jQuery(ds_answer_input).show(),setTimeout(function(){jQuery(ds_answer_input).hide()},1e4);break;case"2":example.classList.remove("submitting"),example.classList.add("submitted"),window.location.assign(e.url);break;default:example.classList.remove("submitting"),example.classList.add("submitted"),jQuery(ds_answer_input).addClass("error"),jQuery(ds_answer_input).html(e.message),jQuery(ds_answer_input).show(),setTimeout(function(){jQuery(ds_answer_input).hide()},1e4)}})})}function setDonationValue(e){var t=window[e];return t.original_amount=jQuery("#donationvalue-"+e).val(),t.original_amount}function checkTC(e,t){return jQuery(e).hasClass("ds-check-tc")&&!jQuery("#ds-conditions-"+t).is(":checked")}function checkDonationInput(e,t,n){return jQuery(e).hasClass("ds-check-donation")&&!t.original_amount&&!t.original_amount.match(n)}function returnError(e,t,n){"emptyTc"===n?text=t.text.checkTC:"emptyDonation"===n&&(text=t.text.enterAmount),jQuery(e).html(text+"<br/>"),jQuery(e).addClass("error"),jQuery(e).show(),setTimeout(function(){jQuery(e).hide()},1e4)}function modalEvent(e){var t=document.getElementById("modal-"+e);t.style.display="block",document.getElementsByClassName("ds-close")[0].onclick=function(){t.style.display="none"},window.onclick=function(e){e.target==t&&(t.style.display="none")}}jQuery(".direct-stripe-button-id").on("click",function(e){var t=jQuery(this).data("id");if(t.length<=0)console.log("DS instance button missing");else{0<jQuery(".donationvalue").length&&setDonationValue(t);var n=window[t];if(""!==n.currency)n.currency;else n.general_currency;"1"===n.billing||n.billing,"1"===n.shipping||n.shipping,"1"===n.rememberme||n.rememberme;var r="#ds-answer-"+t;if(""!==n.display_amount&&"subscription"!==n.type&&"donation"!==n.type)parseInt(n.original_amount);else if(""!==n.display_amount&&"donation"===n.type)if("1"===n.zero_decimal||"true"===n.zero_decimal)parseInt(n.original_amount);else parseFloat(100*n.original_amount);else;var i=checkTC(this,t),o=checkDonationInput(this,n,/^\+?[0-9]*\.?[0-9]+$/);if(i)return returnError(r,direct_stripe_script_vars,"emptyTc"),!1;if(o)return returnError(r,direct_stripe_script_vars,"emptyDonation"),!1;modalEvent(t),e.preventDefault()}}),window.addEventListener("popstate",function(){handler.close()}),function(){var e=stripe.elements({locale:"auto"}),t=e.create("card",{iconStyle:"solid",style:{base:{iconColor:"#fff",color:"#fff",fontWeight:400,fontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",fontSize:"16px",fontSmoothing:"antialiased","::placeholder":{color:"#BFAEF6"},":-webkit-autofill":{color:"#fce883"}},invalid:{iconColor:"#FFC7EE",color:"#FFC7EE"}}});t.mount("#example5-card");var n=stripe.paymentRequest({country:"US",currency:"usd",total:{amount:2500,label:"Total"},requestShipping:!0,shippingOptions:[{id:"free-shipping",label:"Free shipping",detail:"Arrives in 5 to 7 days",amount:0}]});n.on("token",function(e){console.log("result"+e);var t=document.querySelector(".example5");t.querySelector(".token").innerText=e.token.id,t.classList.add("submitted"),e.complete("success")});var r=e.create("paymentRequestButton",{paymentRequest:n,style:{paymentRequestButton:{theme:"light"}}});n.canMakePayment().then(function(e){e&&(document.querySelector(".example5 .card-only").style.display="none",document.querySelector(".example5 .payment-request-available").style.display="block",r.mount("#example5-paymentRequest"))}),registerElements([t],"example5")}();